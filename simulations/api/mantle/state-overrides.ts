// file: state-overrides.ts
import axios from "axios";

(function main() {
  simulateTransaction().catch(console.error);
})();

async function simulateTransaction() {
  const { TENDERLY_ACCOUNT_ID, TENDERLY_PROJECT, TENDERLY_ACCESS_KEY } = process.env;
  try {
    console.time("State Overrides: State Overrides");

    const simulationResponse = await axios.post(
      `https://api.tenderly.co/api/v1/account/${TENDERLY_ACCOUNT_ID}/project/${TENDERLY_PROJECT}/simulate`,
      {
        network_id: "5000",
        // use the state from this block number
        block_number: 48768867,
        transaction_index: 0,
        // quick mode - does not decode call trace and events logs
        simulation_type: "quick",
        // simulations show up in the dashboard (success or fail)
        save: true,
        // failing simulations show up in the dashboard
        save_if_fails: true,

        from: "0x43d21445a91e1a7236302cd9144f0957bf812509",

        to: "0x2fa13cf695ec51ded5b8e45ad0bef838ab17e2af",
        gas: 424376,
        gas_price: "50000000",
        value: "1750000000000000000",
        timestamp: "0x65aa617c",
        // Optional: pin to specific block and timestamp.
        // If omitted, timestamp from the  `block_number` will be used
        block_header: {
          number: "0x2E82763",
          timestamp: "0x65aa617c",
        },
        // state override
        state_objects:{
          // the MantleCowboy contract
          "0xa7236ac4ae735bcad76e3d56d07d929a9be865f6":{
            // new balance
            balance: "0x38d7ea4c68000",
            // overriding a field
            state: {
              "0x05aa50e0245fb5bd11723463874e0d0dff163054a3aa4aabe593be47b4086ae6": "0x0000000000000000000000000000000000000000000000000000000000000000"
            }
          }
        },
        // access list
        access_list: [],
        generate_access_list: true,
        // the raw call-data of the TX
        input:
          "0x149b8ce60000000000000000000000000000000000000000000000000000000000000060000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000004c00000000000000000000000000000000000000000000000000000000000000620000000000078921b65aa3192c04e7b117f5a66c18dc7f44681bbc73fb3b41d2143d21445a91e1a7265aabe32eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee36302cd9144f0957bf8125097538262ae993ca117a0e481f908209137a46268ecfbef62eae5240047d2d1be3b60c8e9f44e914235bbc7379b448030fc565d88f3e09245a2293a46d1c229b18f1088038f713548cf0f780fe5e31e0e3a82806ca00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000080000000000000000000000000a7236ac4ae735bcad76e3d56d07d929a9be865f6000201000000000000c8000000000000000000000000000000000000000000000000000004db73254763000000000000000000000000000000000000000538860000000004db7325476300000000000000000000000000000000000000053856000000000088bb1c65aa4c05b9b4524a03321af1adad77a0f5bb4bebeabe468143d21445a91e1a7265aabc85eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee36302cd9144f0957bf8125097538262ae993ca117a0e481f908209137a46268e5ef85586709d9c318b87584056a6b2b8f938185a06360a8587b7ef4ee1e2fe056cabaf4f0ad77c0a3a01f3243848d926d031074775e952f7f42d97627f5d742000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000080000000000000000000000000a7236ac4ae735bcad76e3d56d07d929a9be865f6000201000000000000c8000000000000000000000000000000000000000000000000000004db73254763000000000000000000000000000000000000000445e00000000004db73254763000000000000000000000000000000000000000445cf000000000079921b65aa4af5c04e7b117f5a66c18dc7f44681bbc73fb3b41d2143d21445a91e1a7265aad795eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee36302cd9144f0957bf8125097538262ae993ca117a0e481f908209137a46268ec308873eddf276dc05e9f076ec852eade5d0ebac082ca246f4a543cc0b270fbc17535fe9c7a3dd9145f03c5815f7cc9a3fe1afdb4fa2c646d3e762bc59bb184a00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000080010000000000000000000000a7236ac4ae735bcad76e3d56d07d929a9be865f6000201000000000000c8000000000000000000000000000000000000000000000000000004db73254763000000000000000000000000000000000000000531390000000004db732547630000000000000000000000000000000000000005313c000000000088bf1b65aa4c3bb9b4524a03321af1adad77a0f5bb4bebeabe468143d21445a91e1a7265aabcbbeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee36302cd9144f0957bf8125097538262ae993ca117a0e481f908209137a46268e80170ea53eb188c0b57578c27c40b3a6bcc19e4b2247e3bd5a58041c150f974b69cc184e03a8330ff4ebac4908f569fdad8fbc9b8b3e3c8f275e0edfd09f1da700000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000080010000000000000000000000a7236ac4ae735bcad76e3d56d07d929a9be865f6000201000000000000c8000000000000000000000000000000000000000000000000000004db73254763000000000000000000000000000000000000000445d40000000004db73254763000000000000000000000000000000000000000445d5000000000088c11c65aa4c57b9b4524a03321af1adad77a0f5bb4bebeabe468143d21445a91e1a7265aabcd7eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee36302cd9144f0957bf8125097538262ae993ca117a0e481f908209137a46268ec71f57e824d4a1c8b4cd1368149b85e2189fde74db79f6f3b0739efcd04c79bd3ca03ad29c3d2b3ce683453a605ee227c4f7ec4ca7a5598ac9ccf0990bfe340c00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000080000000000000000000000000a7236ac4ae735bcad76e3d56d07d929a9be865f6000201000000000000c8000000000000000000000000000000000000000000000000000004db73254763000000000000000000000000000000000000000445ee0000000004db73254763000000000000000000000000000000000000000445f5",
      },
      {
        headers: {
          "X-Access-Key": TENDERLY_ACCESS_KEY,
        },
      }
    );

    console.time("State Overrides: State Overrides");

    console.log(
      "Simulation Success (expected to fail, we removed one of the owners)",
      simulationResponse.data.simulation.status
    );
  } catch (e: any) {
    console.log(e.response.data.error);
  }
}
